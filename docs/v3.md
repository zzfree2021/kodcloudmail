## V3 ç‰ˆæœ¬æ›´æ–°æ—¥å¿—

### ç®€ä»‹
V3 ç‰ˆæœ¬å›´ç»•â€œè´¦æˆ·ä½“ç³» + ç®¡ç†åå° + æƒé™ä¸ä½“éªŒâ€è¿›è¡Œé‡æ„ä¸å¢å¼ºï¼Œæ–°å¢ç”¨æˆ·ç™»å½•ç³»ç»Ÿã€ä¸‰å±‚æƒé™æ¨¡å‹ã€ç»Ÿä¸€é£æ ¼çš„ç®¡ç†åå°äºŒçº§é¡µé¢ï¼Œä»¥åŠæ›´å®Œå–„çš„é”™è¯¯æç¤ºä¸æ¼”ç¤ºæ¨¡å¼ã€‚

### å…³é”®æ›´æ–°

#### 1) è´¦æˆ·ä¸æƒé™
- **ä¸‰å±‚æƒé™**ï¼š
  - **ä¸¥æ ¼ç®¡ç†å‘˜**ï¼ˆENV: `ADMIN_NAME`ï¼Œé»˜è®¤ `admin`ï¼‰ï¼šå¯ç™»å½•åå°ã€æŸ¥çœ‹å…¨é‡é‚®ç®±ï¼›å…¶ç½®é¡¶ä¸ºâ€œç”¨æˆ·çº§â€å¹¶äº’ä¸å¹²æ‰°ï¼›å…·å¤‡æœ€é«˜æ“ä½œæƒé™ã€‚
  - **é«˜çº§ç”¨æˆ·**ï¼ˆæ•°æ®åº“ `role=admin`ï¼‰ï¼šä»…èƒ½ç®¡ç†åˆ†é…ç»™è‡ªå·±çš„é‚®ç®±ï¼Œé»˜è®¤ä¸Šé™ 20ï¼Œé»˜è®¤å…è®¸å‘ä¿¡ï¼›ä¸å¯è®¿é—®ç”¨æˆ·ç®¡ç†åå°å…¥å£ã€‚
  - **æ™®é€šç”¨æˆ·**ï¼ˆæ•°æ®åº“ `role=user`ï¼‰ï¼šæœ€ä½æƒé™ï¼Œé»˜è®¤ä¸Šé™ 10ï¼Œé»˜è®¤ä¸å…è®¸å‘ä¿¡ï¼›åˆ é™¤é‚®ç®±ä¼šæç¤ºâ€œæ²¡æƒé™åˆ é™¤â€ã€‚
- ç™»å½•æ¥å£ä¼šåœ¨è¿”å›ä½“ä¸ JWT ä¸­æºå¸¦ `role`ã€`userId`ã€`can_send`ã€`mailbox_limit` ç­‰å­—æ®µï¼Œå‰ç«¯æ®æ­¤è¿›è¡Œ UI å‘ˆç°ä¸æƒé™æ§åˆ¶ã€‚

#### 2) ç®¡ç†åå°ï¼ˆAdminï¼‰
- ç”¨æˆ·åˆ—è¡¨ï¼š
  - æ“ä½œåŒºç²¾ç®€ä¸ºâ€œé‚®ç®±â€â€œç¼–è¾‘â€ä¸¤æŒ‰é’®ï¼›
  - æ–°å¢â€œèƒ½å¦å‘ä»¶â€åˆ—ï¼›
  - åˆ—å®½ä¼˜åŒ–ä»¥å®Œæ•´æ˜¾ç¤ºâ€œåˆ›å»ºæ—¶é—´â€ï¼›
  - â€œåˆ·æ–°â€æŒ‰é’®ç§»åˆ°â€œç”¨æˆ·åˆ—è¡¨â€æ ‡é¢˜æ æœ€å³ä¾§ã€‚
- ç¼–è¾‘ç”¨æˆ·ï¼ˆè‡ªå®šä¹‰äºŒçº§é¡µé¢/æ¨¡æ€ï¼‰ï¼š
  - è¡¨å•æ …æ ¼åŒ–å¸ƒå±€ï¼Œæ ‡é¢˜å¤„æ˜¾ç¤ºå½“å‰ç”¨æˆ·åï¼›
  - â€œè§’è‰²â€â€œå…è®¸å‘ä»¶â€æ”¹ä¸ºå‹¾é€‰å¼€å…³ï¼›
  - æ–°å¢â€œæ›´æ–°ç”¨æˆ·â€æ‰‹åŠ¨ä¿å­˜ã€â€œé‡ç½®å¯†ç â€â€œä¿®æ”¹ç”¨æˆ·åâ€ï¼›
  - åº•éƒ¨æŒ‰é’®å›ºå®šå¯è§ï¼Œç‚¹å‡»ç©ºç™½å¯å…³é—­ï¼ˆä¸ä¿å­˜ï¼‰ï¼›
  - åˆ é™¤ç”¨æˆ·é‡‡ç”¨è‡ªå®šä¹‰ç¡®è®¤æ¡†ã€‚
- åˆ†é…é‚®ç®±ï¼šæ”¯æŒä¸€æ¬¡æ€§è¾“å…¥å¤šè¡Œé‚®ç®±åœ°å€è¿›è¡Œæ‰¹é‡åˆ†é…ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰ã€‚

#### 3) é¦–é¡µä½“éªŒ
- å†å²é‚®ç®±æ ‡é¢˜æ—æ˜¾ç¤ºé…é¢ï¼š`å·²ç”¨ / æ€»æ•°`ï¼ˆæ¥è‡ª `/api/user/quota`ï¼‰ã€‚
- ç½®é¡¶ï¼ˆğŸ“/ğŸ“Œï¼‰ï¼š
  - ç½®é¡¶çŠ¶æ€æ”¹ä¸º**ç”¨æˆ·çº§**ï¼ˆè¡¨ `user_mailboxes.is_pinned`ï¼‰ï¼Œä¸åŒç”¨æˆ·äº’ä¸å½±å“ï¼›
  - ä¸¥æ ¼ç®¡ç†å‘˜ä¸æ™®é€š/é«˜çº§ç”¨æˆ·å‡å¯å¯¹â€œè‡ªå·±ç»‘å®šçš„é‚®ç®±â€ç½®é¡¶ï¼›
  - åˆ—è¡¨æŒ‰ç½®é¡¶ä¼˜å…ˆã€å†æŒ‰æ—¶é—´æ’åºã€‚
- åˆ é™¤æƒé™ï¼šæ™®é€šç”¨æˆ·åˆ é™¤è¿”å›â€œæ²¡æƒé™åˆ é™¤â€ï¼Œå‰ç«¯ toast æ¸…æ™°æç¤ºã€‚
- è§’è‰²å¾½æ ‡ï¼šåœ¨é¡¶éƒ¨å±•ç¤ºâ€œæ™®é€šç”¨æˆ·/é«˜çº§ç”¨æˆ·/è¶…çº§ç®¡ç†å‘˜â€çŠ¶æ€ä¸ç”¨æˆ·åã€‚
- ç®¡ç†å…¥å£ï¼šä»…ä¸¥æ ¼ç®¡ç†å‘˜å’Œè®¿å®¢æ¼”ç¤ºæ¨¡å¼å¯è§ã€‚

#### 4) æ¼”ç¤º/Mock æ¨¡å¼
- ä½¿ç”¨å†…ç½® `MOCK_DOMAINS` ç”Ÿæˆæ¼”ç¤ºé‚®ç®±ï¼Œä¸è°ƒç”¨çœŸå® API åŸŸåï¼›
- åˆå§‹åŒ–ç”Ÿæˆå¤šä¸ªæ¼”ç¤ºç”¨æˆ·ï¼Œå¹¶ä¸ºæ¯ä¸ªç”¨æˆ·ç”Ÿæˆå¤šæ¡é‚®ç®±ï¼Œä¾¿äºå±•ç¤ºå†å²åˆ—è¡¨ä¸ç½®é¡¶äº¤äº’ã€‚

#### 5) é”™è¯¯ä¸äº¤äº’
- è¾¾åˆ°é‚®ç®±ä¸Šé™æ—¶ï¼Œ`/api/generate` ä¸ `/api/create` è¿”å› 400ï¼Œå‰ç«¯æ”¹ä¸ºè­¦å‘Šæç¤ºè€ŒéæˆåŠŸï¼›
- æ™®é€šç”¨æˆ·åˆ é™¤é‚®ç®±è¿”å› 403 å¹¶æç¤ºâ€œæ²¡æƒé™åˆ é™¤â€ã€‚

### ç›¸å…³é…ç½®
- `ADMIN_NAME`ï¼šä¸¥æ ¼ç®¡ç†å‘˜ç”¨æˆ·åï¼ˆé»˜è®¤ `admin`ï¼‰ã€‚
- `ADMIN_PASSWORD`ï¼šä¸¥æ ¼ç®¡ç†å‘˜å¯†ç ã€‚
- `MAIL_DOMAIN`ï¼šå¯é…ç½®å¤šä¸ªåŸŸåï¼ˆé€—å·/ç©ºæ ¼åˆ†éš”ï¼‰ã€‚

### æˆªå›¾
> ä»¥ä¸‹ä¸ºå¯¹åº”åŠŸèƒ½çš„ç•Œé¢å±•ç¤ºï¼š
![ç”¨æˆ·ç™»é™†é¡µ-é¦–é¡µ](../pic/v3/denglujianding.png)
![ç”¨æˆ·ç®¡ç†-é¦–é¡µ](../pic/v3/yonghuguanli.png)
![åˆ†é…é‚®ç®±ï¼ˆå•ä¸ªï¼‰](../pic/v3/fenpeiyouxiang.png)
![åˆ†é…é‚®ç®±ï¼ˆå¤šä¸ªï¼‰](../pic/v3/fenpeiyouxiangduoge.png)
![ç¼–è¾‘ç”¨æˆ·ä¿¡æ¯](../pic/v3/bianjiyonghuxinxi.png)
![åˆ é™¤ç”¨æˆ·ç¡®è®¤](../pic/v3/shanchuyonghu.png)
![åˆ é™¤å¤±è´¥ç¤ºä¾‹](../pic/v3/shanchushibai.png)
![é‚®ç®±ä¸Šé™æç¤º](../pic/v3/youxiangshangxian.png)

### ä¸»è¦æ¶‰åŠæ–‡ä»¶
- å‰ç«¯ï¼š`public/app.js`ã€`public/admin.html`ã€`public/admin.css`ã€`public/admin.js`ã€`public/templates/app.html`
- åç«¯ï¼š`src/server.js`ã€`src/apiHandlers.js`ã€`src/database.js`

### å¤‡æ³¨
- è‹¥ä»æ—§ç‰ˆæœ¬å‡çº§ï¼Œé¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨è¿ç§»éœ€è¦çš„å­—æ®µï¼ˆå¦‚ `user_mailboxes.is_pinned`ï¼‰ã€‚
- è‹¥ä»æ—§ç‰ˆæœ¬å‡çº§ï¼ŒæŠ¥é”™æ— æ³•åŠ è½½ç­‰ç­‰ï¼Œå°è¯•é‡ç½®D1æ•°æ®åº“


